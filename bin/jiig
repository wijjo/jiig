#!/usr/bin/env python3

# Copyright (C) 2023, Steven Cooper
#
# This file is part of Jiig.
#
# Jiig is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# Jiig is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with Jiig.  If not, see <https://www.gnu.org/licenses/>.

import sys

# Enable jiig imports if not in Python load path.
# noinspection PyUnresolvedReferences
import _check_jiig

from jiig.startup import tool_main
from jiig.task import (
    Task,
    TaskGroup,
    TaskTree,
)
from jiig.tool import ToolMetadata


def main():
    """Jiig script main."""
    # Tool metadata.
    meta = ToolMetadata(
        tool_name='jiig',
        project_name='Jiig',
        description='Jiig administration tool.',
        version='0.5',
        author='Steve Cooper',
        copyright='2021-2023, Steve Cooper',
        email='steve@wijjo.com',
        url='https://github.com/wijjo/jiig',
        pip_packages=['build', 'pdoc3', 'PySimpleGUI'],
    )

    # Declare tasks and task groups that are available via CLI.
    task_tree = TaskTree(
        sub_tasks=[
            TaskGroup(
                name='build',
                sub_tasks=[
                    Task(name='sdist'),
                ],
            ),
            TaskGroup(
                name='config',
                sub_tasks=[
                    Task(name='toml_to_json')
                ],
            ),
            TaskGroup(
                name='doc',
                sub_tasks=[
                    Task(name='html'),
                    Task(name='markdown'),
                    Task(name='pdf'),
                    Task(name='server', cli_options={'port': ['-p', '--port']}),
                ],
            ),
            Task(name='unittest'),
        ],
    )

    # Run tool.
    tool_main(
        meta=meta,
        script_path=__file__,
        task_tree=task_tree,
        runner_args=sys.argv[:1],
        cli_args=sys.argv[1:],
    )


if __name__ == '__main__':
    main()
